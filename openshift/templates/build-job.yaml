apiVersion: batch/v1beta1
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: build-job
spec:
  schedule: "14 4 * * 0" # prod
  concurrencyPolicy: Forbid
  startingDeadlineSeconds: 90 # 1.5 min
  activeDeadlineSeconds: 600  # 10 min
  suspend: false
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: build-job
            role: job
        spec:
          containers:
            - name: minio-data-prune
              image: "image-registry.openshift-image-registry.svc:5000/openshift/cli:latest"
              command:
                - /bin/sh
              args:
                - -c
                - oc start-build patroni-postgres --follow
          restartPolicy: OnFailure
          serviceAccountName: github-cicd
          # imagePullSecrets:
          #   - name: artifactory-creds
